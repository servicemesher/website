<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="872px" preserveAspectRatio="none" style="width:705px;height:872px;" version="1.1" viewBox="0 0 705 872" width="705px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="524.8398" style="stroke: #383838; stroke-width: 1.0;" width="10" x="234.5" y="297.5977"/><rect fill="#FFFFFF" height="463.1406" style="stroke: #000000; stroke-width: 2.0;" width="516.5" x="167" y="352.2969"/><rect fill="#FFFFFF" height="115.2031" style="stroke: none; stroke-width: 1.0;" width="516.5" x="167" y="469.8281"/><rect fill="#FFFFFF" height="115.2031" style="stroke: none; stroke-width: 1.0;" width="516.5" x="167" y="585.0313"/><rect fill="#FFFFFF" height="115.2031" style="stroke: none; stroke-width: 1.0;" width="516.5" x="167" y="700.2344"/><line style="stroke: #383838; stroke-width: 1.0;" x1="239" x2="239" y1="34.2969" y2="225.0938"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="239" x2="239" y1="225.0938" y2="265.8984"/><line style="stroke: #383838; stroke-width: 1.0;" x1="239" x2="239" y1="265.8984" y2="832.4375"/><line style="stroke: #383838; stroke-width: 1.0;" x1="433.5" x2="433.5" y1="34.2969" y2="225.0938"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="433.5" x2="433.5" y1="225.0938" y2="265.8984"/><line style="stroke: #383838; stroke-width: 1.0;" x1="433.5" x2="433.5" y1="265.8984" y2="832.4375"/><line style="stroke: #383838; stroke-width: 1.0;" x1="555.5" x2="555.5" y1="34.2969" y2="225.0938"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="555.5" x2="555.5" y1="225.0938" y2="265.8984"/><line style="stroke: #383838; stroke-width: 1.0;" x1="555.5" x2="555.5" y1="265.8984" y2="832.4375"/><line style="stroke: #383838; stroke-width: 1.0;" x1="645.5" x2="645.5" y1="34.2969" y2="225.0938"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="645.5" x2="645.5" y1="225.0938" y2="265.8984"/><line style="stroke: #383838; stroke-width: 1.0;" x1="645.5" x2="645.5" y1="265.8984" y2="832.4375"/><rect fill="#F8F8F8" height="30.2969" style="stroke: #383838; stroke-width: 1.5;" width="125" x="177" y="3"/><text fill="#000000" font-family="FG Virgil" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="111" x="184" y="22.9951">DiscoveryServer</text><rect fill="#F8F8F8" height="30.2969" style="stroke: #383838; stroke-width: 1.5;" width="125" x="177" y="831.4375"/><text fill="#000000" font-family="FG Virgil" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="111" x="184" y="851.4326">DiscoveryServer</text><rect fill="#F8F8F8" height="30.2969" style="stroke: #383838; stroke-width: 1.5;" width="120" x="373.5" y="3"/><text fill="#000000" font-family="FG Virgil" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="106" x="380.5" y="22.9951">XdsConnection</text><rect fill="#F8F8F8" height="30.2969" style="stroke: #383838; stroke-width: 1.5;" width="120" x="373.5" y="831.4375"/><text fill="#000000" font-family="FG Virgil" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="106" x="380.5" y="851.4326">XdsConnection</text><path d="M508.5,8 L603.5,8 C608.5,8 608.5,21.1484 608.5,21.1484 C608.5,21.1484 608.5,34.2969 603.5,34.2969 L508.5,34.2969 C503.5,34.2969 503.5,21.1484 503.5,21.1484 C503.5,21.1484 503.5,8 508.5,8 " fill="#F8F8F8" style="stroke: #383838; stroke-width: 2.0;"/><path d="M603.5,8 C598.5,8 598.5,21.1484 598.5,21.1484 C598.5,34.2969 603.5,34.2969 603.5,34.2969 " fill="none" style="stroke: #383838; stroke-width: 2.0;"/><text fill="#000000" font-family="FG Virgil" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="508.5" y="25.9951">ReqChannel</text><path d="M508.5,831.4375 L603.5,831.4375 C608.5,831.4375 608.5,844.5859 608.5,844.5859 C608.5,844.5859 608.5,857.7344 603.5,857.7344 L508.5,857.7344 C503.5,857.7344 503.5,844.5859 503.5,844.5859 C503.5,844.5859 503.5,831.4375 508.5,831.4375 " fill="#F8F8F8" style="stroke: #383838; stroke-width: 2.0;"/><path d="M603.5,831.4375 C598.5,831.4375 598.5,844.5859 598.5,844.5859 C598.5,857.7344 603.5,857.7344 603.5,857.7344 " fill="none" style="stroke: #383838; stroke-width: 2.0;"/><text fill="#000000" font-family="FG Virgil" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="508.5" y="849.4326">ReqChannel</text><rect fill="#F8F8F8" height="30.2969" style="stroke: #383838; stroke-width: 1.5;" width="55" x="618.5" y="3"/><text fill="#000000" font-family="FG Virgil" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="41" x="625.5" y="22.9951">Envoy</text><rect fill="#F8F8F8" height="30.2969" style="stroke: #383838; stroke-width: 1.5;" width="55" x="618.5" y="831.4375"/><text fill="#000000" font-family="FG Virgil" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="41" x="625.5" y="851.4326">Envoy</text><rect fill="#FFFFFF" height="524.8398" style="stroke: #383838; stroke-width: 1.0;" width="10" x="234.5" y="297.5977"/><rect fill="#EEEEEE" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="690.5" x="3" y="64.8633"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="693.5" y1="64.8633" y2="64.8633"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="693.5" y1="67.8633" y2="67.8633"/><rect fill="#EEEEEE" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="130" x="283.25" y="54.2969"/><text fill="#000000" font-family="FG Virgil" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="106" x="289.25" y="70.3638">client Request</text><polygon fill="#383838" points="444.5,104.5625,434.5,108.5625,444.5,112.5625,440.5,108.5625" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="438.5" x2="645" y1="108.5625" y2="108.5625"/><text fill="#000000" font-family="FG Virgil" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="450.5" y="103.4966">DiscoveryRequest</text><polygon fill="#383838" points="421.5,144.2617,431.5,148.2617,421.5,152.2617,425.5,148.2617" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="239.5" x2="427.5" y1="148.2617" y2="148.2617"/><text fill="#000000" font-family="FG Virgil" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49" x="246.5" y="143.1958">Receive</text><path d="M12,121.5625 L12,161.5625 L234,161.5625 L234,131.5625 L224,121.5625 L12,121.5625 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><path d="M224,121.5625 L224,131.5625 L234,131.5625 L224,121.5625 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="FG Virgil" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="18" y="138.6294">pilot/pkg/proxy/envoy/v2/ads.go</text><text fill="#000000" font-family="FG Virgil" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="18" y="153.7622">receiveThread</text><polygon fill="#383838" points="250.5,183.9609,240.5,187.9609,250.5,191.9609,246.5,187.9609" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="244.5" x2="432.5" y1="187.9609" y2="187.9609"/><text fill="#000000" font-family="FG Virgil" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="256.5" y="182.895">DiscoveryRequest</text><polygon fill="#383838" points="544,213.0938,554,217.0938,544,221.0938,548,217.0938" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="239.5" x2="550" y1="217.0938" y2="217.0938"/><text fill="#000000" font-family="FG Virgil" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="246.5" y="212.0278">DiscoveryRequest</text><text fill="#000000" font-family="FG Virgil" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="444.75" y="249.3042"/><polygon fill="#383838" points="544,293.5977,554,297.5977,544,301.5977,548,297.5977" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="244.5" x2="550" y1="297.5977" y2="297.5977"/><text fill="#000000" font-family="FG Virgil" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="75" x="251.5" y="292.5317">GetRequest</text><path d="M8,270.8984 L8,310.8984 L230,310.8984 L230,280.8984 L220,270.8984 L8,270.8984 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><path d="M220,270.8984 L220,280.8984 L230,280.8984 L220,270.8984 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="FG Virgil" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="14" y="287.9653">pilot/pkg/proxy/envoy/v2/ads.go</text><text fill="#000000" font-family="FG Virgil" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="189" x="14" y="303.0981">StreamAggregatedResources</text><polygon fill="#383838" points="255.5,333.2969,245.5,337.2969,255.5,341.2969,251.5,337.2969" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="249.5" x2="555" y1="337.2969" y2="337.2969"/><text fill="#000000" font-family="FG Virgil" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="261.5" y="332.231">DiscoveryRequest</text><path d="M167,352.2969 L231,352.2969 L231,359.2969 L221,369.2969 L167,369.2969 L167,352.2969 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="463.1406" style="stroke: #000000; stroke-width: 2.0;" width="516.5" x="167" y="352.2969"/><text fill="#000000" font-family="FG Virgil" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="182" y="365.3638">alt</text><text fill="#000000" font-family="FG Virgil" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="91" x="246" y="364.5073">[Cluster Type]</text><line style="stroke: #383838; stroke-width: 1.0;" x1="244.5" x2="286.5" y1="390.5625" y2="390.5625"/><line style="stroke: #383838; stroke-width: 1.0;" x1="286.5" x2="286.5" y1="390.5625" y2="403.5625"/><line style="stroke: #383838; stroke-width: 1.0;" x1="245.5" x2="286.5" y1="403.5625" y2="403.5625"/><polygon fill="#383838" points="255.5,399.5625,245.5,403.5625,255.5,407.5625,251.5,403.5625" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="FG Virgil" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="59" x="251.5" y="385.4966">pushCDS</text><polygon fill="#383838" points="421.5,428.6953,431.5,432.6953,421.5,436.6953,425.5,432.6953" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="244.5" x2="427.5" y1="432.6953" y2="432.6953"/><text fill="#000000" font-family="FG Virgil" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="165" x="251.5" y="427.6294">send(DiscoveryResponse)</text><polygon fill="#383838" points="634,457.8281,644,461.8281,634,465.8281,638,461.8281" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="433.5" x2="640" y1="461.8281" y2="461.8281"/><text fill="#000000" font-family="FG Virgil" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="440.5" y="456.7622">DiscoveryResponse</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="167" x2="683.5" y1="470.8281" y2="470.8281"/><text fill="#000000" font-family="FG Virgil" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="118" x="172" y="481.0386">[Listener Request]</text><line style="stroke: #383838; stroke-width: 1.0;" x1="244.5" x2="286.5" y1="505.7656" y2="505.7656"/><line style="stroke: #383838; stroke-width: 1.0;" x1="286.5" x2="286.5" y1="505.7656" y2="518.7656"/><line style="stroke: #383838; stroke-width: 1.0;" x1="245.5" x2="286.5" y1="518.7656" y2="518.7656"/><polygon fill="#383838" points="255.5,514.7656,245.5,518.7656,255.5,522.7656,251.5,518.7656" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="FG Virgil" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="57" x="251.5" y="500.6997">pushLDS</text><polygon fill="#383838" points="421.5,543.8984,431.5,547.8984,421.5,551.8984,425.5,547.8984" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="244.5" x2="427.5" y1="547.8984" y2="547.8984"/><text fill="#000000" font-family="FG Virgil" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="165" x="251.5" y="542.8325">send(DiscoveryResponse)</text><polygon fill="#383838" points="634,573.0313,644,577.0313,634,581.0313,638,577.0313" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="433.5" x2="640" y1="577.0313" y2="577.0313"/><text fill="#000000" font-family="FG Virgil" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="440.5" y="571.9653">DiscoveryResponse</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="167" x2="683.5" y1="586.0313" y2="586.0313"/><text fill="#000000" font-family="FG Virgil" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="123" x="172" y="596.2417">[Endpoint Request]</text><line style="stroke: #383838; stroke-width: 1.0;" x1="244.5" x2="286.5" y1="620.9688" y2="620.9688"/><line style="stroke: #383838; stroke-width: 1.0;" x1="286.5" x2="286.5" y1="620.9688" y2="633.9688"/><line style="stroke: #383838; stroke-width: 1.0;" x1="245.5" x2="286.5" y1="633.9688" y2="633.9688"/><polygon fill="#383838" points="255.5,629.9688,245.5,633.9688,255.5,637.9688,251.5,633.9688" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="FG Virgil" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="251.5" y="615.9028">pushEDS</text><polygon fill="#383838" points="421.5,659.1016,431.5,663.1016,421.5,667.1016,425.5,663.1016" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="244.5" x2="427.5" y1="663.1016" y2="663.1016"/><text fill="#000000" font-family="FG Virgil" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="165" x="251.5" y="658.0356">send(DiscoveryResponse)</text><polygon fill="#383838" points="634,688.2344,644,692.2344,634,696.2344,638,692.2344" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="433.5" x2="640" y1="692.2344" y2="692.2344"/><text fill="#000000" font-family="FG Virgil" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="440.5" y="687.1685">DiscoveryResponse</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="167" x2="683.5" y1="701.2344" y2="701.2344"/><text fill="#000000" font-family="FG Virgil" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="103" x="172" y="711.4448">[Route Request]</text><line style="stroke: #383838; stroke-width: 1.0;" x1="244.5" x2="286.5" y1="736.1719" y2="736.1719"/><line style="stroke: #383838; stroke-width: 1.0;" x1="286.5" x2="286.5" y1="736.1719" y2="749.1719"/><line style="stroke: #383838; stroke-width: 1.0;" x1="245.5" x2="286.5" y1="749.1719" y2="749.1719"/><polygon fill="#383838" points="255.5,745.1719,245.5,749.1719,255.5,753.1719,251.5,749.1719" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="FG Virgil" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="251.5" y="731.106">pushRoute</text><polygon fill="#383838" points="421.5,774.3047,431.5,778.3047,421.5,782.3047,425.5,778.3047" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="244.5" x2="427.5" y1="778.3047" y2="778.3047"/><text fill="#000000" font-family="FG Virgil" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="165" x="251.5" y="773.2388">send(DiscoveryResponse)</text><polygon fill="#383838" points="634,803.4375,644,807.4375,634,811.4375,638,807.4375" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="433.5" x2="640" y1="807.4375" y2="807.4375"/><text fill="#000000" font-family="FG Virgil" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="440.5" y="802.3716">DiscoveryResponse</text><!--MD5=[af2b165f0fac02884b520cde1244d250]
@startuml
skinparam monochrome true
skinparam packageStyle rect
skinparam defaultFontName FG Virgil
skinparam shadowing false

queue ReqChannel

participant DiscoveryServer
participant XdsConnection
participant ReqChannel
participant Envoy

== client Request  ==
Envoy -> XdsConnection: DiscoveryRequest
DiscoveryServer -> XdsConnection: Receive
note left
    pilot/pkg/proxy/envoy/v2/ads.go
    receiveThread
end note
return DiscoveryRequest
DiscoveryServer -> ReqChannel: DiscoveryRequest
... ...

DiscoveryServer -> ReqChannel: GetRequest
note left
    pilot/pkg/proxy/envoy/v2/ads.go
    StreamAggregatedResources
end note
activate DiscoveryServer
return DiscoveryRequest

alt Cluster Type
DiscoveryServer -> DiscoveryServer:pushCDS
DiscoveryServer -> XdsConnection:send(DiscoveryResponse)
XdsConnection -> Envoy:DiscoveryResponse

else Listener Request
DiscoveryServer -> DiscoveryServer:pushLDS
DiscoveryServer -> XdsConnection:send(DiscoveryResponse)
XdsConnection -> Envoy:DiscoveryResponse

else Endpoint Request
DiscoveryServer -> DiscoveryServer:pushEDS
DiscoveryServer -> XdsConnection:send(DiscoveryResponse)
XdsConnection -> Envoy:DiscoveryResponse

else Route Request
DiscoveryServer -> DiscoveryServer:pushRoute
DiscoveryServer -> XdsConnection:send(DiscoveryResponse)
XdsConnection -> Envoy:DiscoveryResponse
end
deactivate DiscoveryServer
@enduml

PlantUML version 1.2019.12beta6(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.7.0_25-b15
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>