<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="366px" preserveAspectRatio="none" style="width:717px;height:366px;" version="1.1" viewBox="0 0 717 366" width="717px" zoomAndPan="magnify"><defs/><g><line style="stroke: #383838; stroke-width: 1.0;" x1="214" x2="214" y1="34.2969" y2="166.8281"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="214" x2="214" y1="166.8281" y2="207.6328"/><line style="stroke: #383838; stroke-width: 1.0;" x1="214" x2="214" y1="207.6328" y2="326.1641"/><line style="stroke: #383838; stroke-width: 1.0;" x1="330" x2="330" y1="34.2969" y2="166.8281"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="330" x2="330" y1="166.8281" y2="207.6328"/><line style="stroke: #383838; stroke-width: 1.0;" x1="330" x2="330" y1="207.6328" y2="326.1641"/><line style="stroke: #383838; stroke-width: 1.0;" x1="463" x2="463" y1="34.2969" y2="166.8281"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="463" x2="463" y1="166.8281" y2="207.6328"/><line style="stroke: #383838; stroke-width: 1.0;" x1="463" x2="463" y1="207.6328" y2="326.1641"/><line style="stroke: #383838; stroke-width: 1.0;" x1="584" x2="584" y1="34.2969" y2="166.8281"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="584" x2="584" y1="166.8281" y2="207.6328"/><line style="stroke: #383838; stroke-width: 1.0;" x1="584" x2="584" y1="207.6328" y2="326.1641"/><line style="stroke: #383838; stroke-width: 1.0;" x1="672" x2="672" y1="34.2969" y2="166.8281"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="672" x2="672" y1="166.8281" y2="207.6328"/><line style="stroke: #383838; stroke-width: 1.0;" x1="672" x2="672" y1="207.6328" y2="326.1641"/><rect fill="#F8F8F8" height="30.2969" style="stroke: #383838; stroke-width: 1.5;" width="87" x="171" y="3"/><text fill="#000000" font-family="FG Virgil" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="178" y="22.9951">PilotServer</text><rect fill="#F8F8F8" height="30.2969" style="stroke: #383838; stroke-width: 1.5;" width="87" x="171" y="325.1641"/><text fill="#000000" font-family="FG Virgil" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="178" y="345.1592">PilotServer</text><rect fill="#F8F8F8" height="30.2969" style="stroke: #383838; stroke-width: 1.5;" width="125" x="268" y="3"/><text fill="#000000" font-family="FG Virgil" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="111" x="275" y="22.9951">DiscoveryServer</text><rect fill="#F8F8F8" height="30.2969" style="stroke: #383838; stroke-width: 1.5;" width="125" x="268" y="325.1641"/><text fill="#000000" font-family="FG Virgil" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="111" x="275" y="345.1592">DiscoveryServer</text><rect fill="#F8F8F8" height="30.2969" style="stroke: #383838; stroke-width: 1.5;" width="120" x="403" y="3"/><text fill="#000000" font-family="FG Virgil" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="106" x="410" y="22.9951">XdsConnection</text><rect fill="#F8F8F8" height="30.2969" style="stroke: #383838; stroke-width: 1.5;" width="120" x="403" y="325.1641"/><text fill="#000000" font-family="FG Virgil" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="106" x="410" y="345.1592">XdsConnection</text><rect fill="#F8F8F8" height="30.2969" style="stroke: #383838; stroke-width: 1.5;" width="102" x="533" y="3"/><text fill="#000000" font-family="FG Virgil" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="88" x="540" y="22.9951">GRPC Server</text><rect fill="#F8F8F8" height="30.2969" style="stroke: #383838; stroke-width: 1.5;" width="102" x="533" y="325.1641"/><text fill="#000000" font-family="FG Virgil" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="88" x="540" y="345.1592">GRPC Server</text><rect fill="#F8F8F8" height="30.2969" style="stroke: #383838; stroke-width: 1.5;" width="55" x="645" y="3"/><text fill="#000000" font-family="FG Virgil" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="41" x="652" y="22.9951">Envoy</text><rect fill="#F8F8F8" height="30.2969" style="stroke: #383838; stroke-width: 1.5;" width="55" x="645" y="325.1641"/><text fill="#000000" font-family="FG Virgil" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="41" x="652" y="345.1592">Envoy</text><rect fill="#EEEEEE" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="702" x="3" y="64.8633"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="705" y1="64.8633" y2="64.8633"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="705" y1="67.8633" y2="67.8633"/><rect fill="#EEEEEE" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="171" x="268.5" y="54.2969"/><text fill="#000000" font-family="FG Virgil" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="152" x="274.5" y="70.3638">Receive Connections</text><polygon fill="#383838" points="572,104.5625,582,108.5625,572,112.5625,576,108.5625" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="214.5" x2="578" y1="108.5625" y2="108.5625"/><text fill="#000000" font-family="FG Virgil" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="221.5" y="103.4966">Create</text><polygon fill="#383838" points="572,144.2617,582,148.2617,572,152.2617,576,148.2617" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="330.5" x2="578" y1="148.2617" y2="148.2617"/><text fill="#000000" font-family="FG Virgil" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="337.5" y="143.1958">RegisterService</text><path d="M66,121.5625 L66,161.5625 L325,161.5625 L325,131.5625 L315,121.5625 L66,121.5625 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><path d="M315,121.5625 L315,131.5625 L325,131.5625 L315,121.5625 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="FG Virgil" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="238" x="72" y="138.6294">pilot/pkg/proxy/envoy/v2/discovery.go</text><text fill="#000000" font-family="FG Virgil" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="72" y="153.7622">DiscoveryServer.Register</text><text fill="#000000" font-family="FG Virgil" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="447.5" y="191.0386"/><polygon fill="#383838" points="595,224.7656,585,228.7656,595,232.7656,591,228.7656" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="589" x2="671.5" y1="228.7656" y2="228.7656"/><text fill="#000000" font-family="FG Virgil" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="35" x="601" y="223.6997">GRPC</text><polygon fill="#383838" points="341.5,264.4648,331.5,268.4648,341.5,272.4648,337.5,268.4648" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="335.5" x2="583" y1="268.4648" y2="268.4648"/><text fill="#000000" font-family="FG Virgil" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="51" x="347.5" y="263.3989">callback</text><path d="M8,241.7656 L8,281.7656 L326,281.7656 L326,251.7656 L316,241.7656 L8,241.7656 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><path d="M316,241.7656 L316,251.7656 L326,251.7656 L316,241.7656 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="FG Virgil" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="14" y="258.8325">pilot/pkg/proxy/envoy/v2/ads.go</text><text fill="#000000" font-family="FG Virgil" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="297" x="14" y="273.9653">DiscoveryServer.StreamAggregatedResources</text><polygon fill="#383838" points="451,304.1641,461,308.1641,451,312.1641,455,308.1641" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="330.5" x2="457" y1="308.1641" y2="308.1641"/><text fill="#000000" font-family="FG Virgil" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="337.5" y="303.0981">Create</text><!--MD5=[e1ff35f236e1e04b91af61c30671df38]
@startuml
skinparam monochrome true
skinparam packageStyle rect
skinparam defaultFontName FG Virgil
skinparam shadowing false

participant "PilotServer"
participant DiscoveryServer
participant XdsConnection
participant "GRPC Server"
participant Envoy

== Receive Connections ==
PilotServer -> "GRPC Server":Create
DiscoveryServer -> "GRPC Server":RegisterService
note left
    pilot/pkg/proxy/envoy/v2/discovery.go
    DiscoveryServer.Register
end note
...  ...
Envoy -> "GRPC Server":GRPC
"GRPC Server" -> DiscoveryServer:callback
note left
    pilot/pkg/proxy/envoy/v2/ads.go
    DiscoveryServer.StreamAggregatedResources
end note
DiscoveryServer -> XdsConnection:Create
@enduml

PlantUML version 1.2019.11(Sun Sep 22 10:02:15 UTC 2019)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.7.0_25-b15
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>